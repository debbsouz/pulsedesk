<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PulseDesk · New Ticket</title>
  <link rel="stylesheet" href="../css/tokens.css">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/components.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <img src="../assets/logo.svg" alt="PulseDesk logo">
        <span class="name">PulseDesk</span>
      </div>
      <nav class="nav">
        <a href="./dashboard.html">Dashboard</a>
        <a href="./tickets.html">Tickets</a>
        <a class="active" href="./new-ticket.html">New Ticket</a>
        <a href="./settings.html">Settings</a>
        <a href="#">Logout</a>
      </nav>
    </aside>
    <div class="content">
      <header class="topbar">
        <div class="topbar-left">
          <a class="logo-inline" href="./dashboard.html">
            <img src="../assets/logo.svg" alt="PulseDesk logo">
            <span class="wordmark">PulseDesk</span>
          </a>
        </div>
        <div class="topbar-right">
          <div class="avatar">U</div>
        </div>
      </header>
      <main class="main">
        <h1 class="section-title">New Ticket</h1>
        <p class="page-subtitle">Log a new support request with context, priority and attachments.</p>
        <form class="form">
          <div class="field">
            <label class="label" for="subject">Subject</label>
            <input class="input" id="subject" type="text" placeholder="Subject">
          </div>
          <div class="field">
            <label class="label" for="description">Description</label>
            <textarea class="textarea" id="description" placeholder="Description"></textarea>
          </div>
          <div class="field">
            <label class="label" for="category">Category</label>
            <select class="select" id="category">
              <option value="">Select</option>
              <option>Support</option>
              <option>Billing</option>
              <option>Bug</option>
            </select>
          </div>
          <div class="field">
            <label class="label" for="priority">Priority</label>
            <select class="select" id="priority">
              <option value="">Select</option>
              <option>Low</option>
              <option>Medium</option>
              <option>High</option>
            </select>
          </div>
          <div class="field">
            <label class="label" for="attachment">Attachment</label>
            <input class="input" id="attachment" type="file">
          </div>
          <div class="actions">
            <button class="button" type="button">Submit</button>
            <a class="button secondary" href="./tickets.html">Cancel</a>
          </div>
        </form>
        <footer class="footer">PulseDesk © 2026 – Internal Support Platform.</footer>
      </main>
    </div>
  </div>
<script src="../js/app.js"></script>
<script src="../js/storage.js"></script>
<script>
  (function(){
    var S = window.PulseDeskStorage;
    if (!S) return;
    var $subject = document.getElementById("subject");
    var $description = document.getElementById("description");
    var $category = document.getElementById("category");
    var $priority = document.getElementById("priority");
    var $file = document.getElementById("attachment");
    var $submit = document.querySelector(".actions .button");
    function rid(){ return "t_"+Date.now().toString(36)+Math.random().toString(36).slice(2,8); }
    function buildAttachment(file, cb){
      if (!file) return cb(null);
      var reader = new FileReader();
      reader.onload = function(){
        cb({
          id: "a_"+Date.now().toString(36)+Math.random().toString(36).slice(2,8),
          name: file.name,
          type: file.type || "application/octet-stream",
          size: file.size || 0,
          dataUrl: reader.result,
          at: new Date().toISOString()
        });
      };
      reader.onerror = function(){ cb(null); };
      reader.readAsDataURL(file);
    }
    $submit.addEventListener("click", function(){
      var subject = ($subject.value||"").trim();
      var description = ($description.value||"").trim();
      var category = $category.value || "";
      var prLabel = $priority.value || "Low";
      var priority = String(prLabel).toLowerCase();
      var id = rid();
      var f = ($file.files && $file.files[0]) ? $file.files[0] : null;
      buildAttachment(f, function(att){
        var attachments = att ? [att] : [];
        var ticket = {
          id: id,
          title: subject,
          subject: subject,
          description: description,
          category: category,
          priority: priority,
          status: "open",
          assignee: "",
          createdAt: new Date().toISOString(),
          internalNotes: "",
          comments: [],
          attachments: attachments,
          history: [{ type: "created", at: new Date().toISOString() }]
        };
        S.addTicket(ticket);
        window.location.href = "./ticket.html?id="+encodeURIComponent(id);
      });
    });
  })();
</script>
</body>
</html>
