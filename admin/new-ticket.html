<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PulseDesk · New Ticket</title>
  <link rel="stylesheet" href="../css/tokens.css">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/components.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar" aria-label="Primary">
      <div class="brand">
        <img src="../assets/logo.svg" alt="PulseDesk logo">
        <span class="name">PulseDesk</span>
      </div>
      <nav class="nav">
        <a class="nav-item" href="./dashboard.html" aria-label="Dashboard" title="Dashboard"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 4h7v7H4V4zm9 0h7v5h-7V4zM4 13h7v7H4v-7zm9-2h7v9h-7v-9z"/></svg></span><span class="nav-label">Dashboard</span></a>
        <a class="nav-item" href="./tickets.html" aria-label="Tickets" title="Tickets"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 6h16v10H7l-3 3V6z"/></svg></span><span class="nav-label">Tickets</span></a>
        <a class="nav-item active" href="./new-ticket.html" aria-label="New Ticket" title="New Ticket"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="2" stroke-linecap="round" d="M12 5v14M5 12h14"/></svg></span><span class="nav-label">New Ticket</span></a>
        <a class="nav-item" href="#" aria-label="Chats" title="Chats"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 5h16v10H7l-3 3V5z"/></svg></span><span class="nav-label">Chats</span></a>
        <a class="nav-item" href="#" aria-label="Customers" title="Customers"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm-7 8a7 7 0 0 1 14 0H5z"/></svg></span><span class="nav-label">Customers</span></a>
        <a class="nav-item" href="#" aria-label="Resources" title="Resources"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 4h18v4H3V4zm0 6h18v4H3v-4zm0 6h18v4H3v-4z"/></svg></span><span class="nav-label">Resources</span></a>
        <a class="nav-item" href="#" aria-label="Contracts" title="Contracts"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M6 3h12v18H6zM9 7h6v2H9zM9 11h6v2H9zM9 15h6v2H9z"/></svg></span><span class="nav-label">Contracts</span></a>
        <a class="nav-item" href="#" aria-label="Reports" title="Reports"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M5 13h4v8H5v-8zm5-6h4v14h-4V7zm5 3h4v11h-4V10z"/></svg></span><span class="nav-label">Reports</span></a>
        <a class="nav-item" href="#" aria-label="Schedule" title="Schedule"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 2h2v3h6V2h2v3h3v15H4V5h3V2zm0 7h10v9H7V9z"/></svg></span><span class="nav-label">Schedule</span></a>
        <a class="nav-item" href="#" aria-label="Knowledge Base" title="Knowledge Base"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 5h14a2 2 0 0 1 2 2v12l-4-2-4 2-4-2-4 2V7a2 2 0 0 1 2-2z"/></svg></span><span class="nav-label">Knowledge Base</span></a>
        <a class="nav-item" href="#" aria-label="Password Vault" title="Password Vault"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 3a6 6 0 0 0-6 6v3H5a2 2 0 0 0-2 2v5h18v-5a2 2 0 0 0-2-2h-1V9a6 6 0 0 0-6-6zm-2 9h4v3h-4v-3z"/></svg></span><span class="nav-label">Password Vault</span></a>
        <a class="nav-item" href="./settings.html" aria-label="Settings" title="Settings"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg></span><span class="nav-label">Settings</span></a>
        <a class="nav-item" href="#" aria-label="Logout" title="Logout"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-width="2" d="M8 4h8v16H8"/><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 8l4 4-4 4M4 12h12"/></svg></span><span class="nav-label">Logout</span></a>
      </nav>
      <div class="nav-cta">
        <a class="new-ticket-cta" href="./new-ticket.html">New Ticket</a>
      </div>
      <div class="sidebar-footer">
        <div class="footer-inner">
          <div class="user-block">
            <div class="avatar">U</div>
            <div class="user-text">
              <div class="user-name">You</div>
              <div class="user-email">you@example.com</div>
            </div>
          </div>
          
        </div>
      </div>
    </aside>
    <div class="content">
      <header class="topbar">
        <div class="topbar-left">
          <a class="logo-inline" href="./dashboard.html">
            <img src="../assets/logo.svg" alt="PulseDesk logo">
            <span class="wordmark">PulseDesk</span>
          </a>
        </div>
        <div class="topbar-right">
          <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle theme">
            <svg class="icon-sun" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
              <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <svg class="icon-moon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path d="M21 12.5A8.5 8.5 0 0 1 11.5 3a7 7 0 1 0 9.5 9.5Z"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <div class="avatar">U</div>
        </div>
      </header>
      <main class="main">
        <h1 class="section-title">New Ticket</h1>
        <p class="page-subtitle">Log a new support request with context, priority and attachments.</p>
        <form class="form">
          <div class="field">
            <label class="label" for="subject">Subject</label>
            <input class="input" id="subject" type="text" placeholder="Subject">
          </div>
          <div class="field">
            <label class="label" for="description">Description</label>
            <textarea class="textarea" id="description" placeholder="Description"></textarea>
          </div>
          <div class="field">
            <label class="label" for="category">Category</label>
            <select class="select" id="category">
              <option value="">Select</option>
              <option>Support</option>
              <option>Billing</option>
              <option>Bug</option>
            </select>
          </div>
          <div class="field">
            <label class="label" for="priority">Priority</label>
            <select class="select" id="priority">
              <option value="">Select</option>
              <option>Low</option>
              <option>Medium</option>
              <option>High</option>
            </select>
          </div>
          <div class="field">
            <label class="label" for="attachment">Attachment</label>
            <input class="input" id="attachment" type="file">
          </div>
          <div class="actions">
            <button class="button" type="button">Submit</button>
            <a class="button secondary" href="./tickets.html">Cancel</a>
          </div>
        </form>
        <footer class="footer">PulseDesk © 2026 – Internal Support Platform.</footer>
      </main>
    </div>
  </div>
<script src="../js/app.js"></script>
<script src="../js/storage.js"></script>
<script src="../js/theme.js"></script>
<script src="../js/sidebar.js"></script>
<script>
  (function(){
    var S = window.PulseDeskStorage;
    if (!S) return;
    var $subject = document.getElementById("subject");
    var $description = document.getElementById("description");
    var $category = document.getElementById("category");
    var $priority = document.getElementById("priority");
    var $file = document.getElementById("attachment");
    var $submit = document.querySelector(".actions .button");
    function rid(){ return "t_"+Date.now().toString(36)+Math.random().toString(36).slice(2,8); }
    function buildAttachment(file, cb){
      if (!file) return cb(null);
      var reader = new FileReader();
      reader.onload = function(){
        cb({
          id: "a_"+Date.now().toString(36)+Math.random().toString(36).slice(2,8),
          name: file.name,
          type: file.type || "application/octet-stream",
          size: file.size || 0,
          dataUrl: reader.result,
          at: new Date().toISOString()
        });
      };
      reader.onerror = function(){ cb(null); };
      reader.readAsDataURL(file);
    }
    $submit.addEventListener("click", function(){
      var subject = ($subject.value||"").trim();
      var description = ($description.value||"").trim();
      var category = $category.value || "";
      var prLabel = $priority.value || "Low";
      var priority = String(prLabel).toLowerCase();
      var id = rid();
      var f = ($file.files && $file.files[0]) ? $file.files[0] : null;
      buildAttachment(f, function(att){
        var attachments = att ? [att] : [];
        var ticket = {
          id: id,
          title: subject,
          subject: subject,
          description: description,
          category: category,
          priority: priority,
          status: "open",
          assignee: "",
          createdAt: new Date().toISOString(),
          internalNotes: "",
          comments: [],
          attachments: attachments,
          history: [{ type: "created", at: new Date().toISOString() }]
        };
        S.addTicket(ticket);
        window.location.href = "./ticket.html?id="+encodeURIComponent(id);
      });
    });
  })();
</script>
</body>
</html>
