<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PulseDesk · Settings</title>
  <link rel="stylesheet" href="../css/tokens.css">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/components.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar" aria-label="Primary">
      <div class="brand">
        <img src="../assets/logo.svg" alt="PulseDesk logo">
        <span class="name">PulseDesk</span>
      </div>
      <nav class="nav">
        <a class="nav-item" href="./dashboard.html" aria-label="Dashboard" title="Dashboard"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 4h7v7H4V4zm9 0h7v5h-7V4zM4 13h7v7H4v-7zm9-2h7v9h-7v-9z"/></svg></span><span class="nav-label">Dashboard</span></a>
        <a class="nav-item" href="./tickets.html" aria-label="Tickets" title="Tickets"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 6h16v10H7l-3 3V6z"/></svg></span><span class="nav-label">Tickets</span></a>
        <a class="nav-item" href="./new-ticket.html" aria-label="New Ticket" title="New Ticket"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="2" stroke-linecap="round" d="M12 5v14M5 12h14"/></svg></span><span class="nav-label">New Ticket</span></a>
        <a class="nav-item" href="#" aria-label="Chats" title="Chats"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 5h16v10H7l-3 3V5z"/></svg></span><span class="nav-label">Chats</span></a>
        <a class="nav-item" href="#" aria-label="Customers" title="Customers"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm-7 8a7 7 0 0 1 14 0H5z"/></svg></span><span class="nav-label">Customers</span></a>
        <a class="nav-item" href="#" aria-label="Resources" title="Resources"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 4h18v4H3V4zm0 6h18v4H3v-4zm0 6h18v4H3v-4z"/></svg></span><span class="nav-label">Resources</span></a>
        <a class="nav-item" href="#" aria-label="Contracts" title="Contracts"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M6 3h12v18H6zM9 7h6v2H9zM9 11h6v2H9zM9 15h6v2H9z"/></svg></span><span class="nav-label">Contracts</span></a>
        <a class="nav-item" href="#" aria-label="Reports" title="Reports"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M5 13h4v8H5v-8zm5-6h4v14h-4V7zm5 3h4v11h-4V10z"/></svg></span><span class="nav-label">Reports</span></a>
        <a class="nav-item" href="#" aria-label="Schedule" title="Schedule"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 2h2v3h6V2h2v3h3v15H4V5h3V2zm0 7h10v9H7V9z"/></svg></span><span class="nav-label">Schedule</span></a>
        <a class="nav-item" href="#" aria-label="Knowledge Base" title="Knowledge Base"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M4 5h14a2 2 0 0 1 2 2v12l-4-2-4 2-4-2-4 2V7a2 2 0 0 1 2-2z"/></svg></span><span class="nav-label">Knowledge Base</span></a>
        <a class="nav-item" href="#" aria-label="Password Vault" title="Password Vault"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 3a6 6 0 0 0-6 6v3H5a2 2 0 0 0-2 2v5h18v-5a2 2 0 0 0-2-2h-1V9a6 6 0 0 0-6-6zm-2 9h4v3h-4v-3z"/></svg></span><span class="nav-label">Password Vault</span></a>
        <a class="nav-item active" href="./settings.html" aria-label="Settings" title="Settings"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg></span><span class="nav-label">Settings</span></a>
        <a class="nav-item" href="#" aria-label="Logout" title="Logout"><span class="nav-ic" aria-hidden="true"><svg viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-width="2" d="M8 4h8v16H8"/><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 8l4 4-4 4M4 12h12"/></svg></span><span class="nav-label">Logout</span></a>
      </nav>
      <div class="nav-cta">
        <a class="new-ticket-cta" href="./new-ticket.html">New Ticket</a>
      </div>
      <div class="sidebar-footer">
        <div class="footer-inner">
          <div class="avatar">U</div>
          <div class="user-text">
            <div class="user-name">You</div>
            <div class="user-email">you@example.com</div>
          </div>
          <button id="themeToggle" class="theme-btn" type="button" aria-label="Toggle theme" title="Toggle theme">
            <span class="theme-ico" aria-hidden="true"></span>
          </button>
        </div>
      </div>
    </aside>
    <div class="content">
      <header class="topbar">
        <div class="topbar-left">
          <a class="logo-inline" href="./dashboard.html">
            <img src="../assets/logo.svg" alt="PulseDesk logo">
            <span class="wordmark">PulseDesk</span>
          </a>
        </div>
        <div class="topbar-right">
          <button id="sidebar-toggle" class="sidebar-toggle" type="button" aria-label="Toggle sidebar" aria-expanded="false">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M7 12h10M7 7h10M7 17h10"/></svg>
          </button>
          <div class="avatar">U</div>
        </div>
      </header>
      <main class="main">
        <h1 class="section-title">Settings</h1>
        <p class="page-subtitle">Configure agent profile, preferences, and data tools for your workspace.</p>
        <div id="settings-toast" aria-live="polite" aria-atomic="true"></div>
        <div class="cards">
          <div class="card">
            <div class="card-title">Profile</div>
            <div class="form">
              <div class="field">
                <label class="label" for="agent-name">Agent Name</label>
                <input class="input" id="agent-name" type="text" placeholder="Your name">
              </div>
              <div class="field">
                <label class="label" for="agent-email">Agent Email</label>
                <input class="input" id="agent-email" type="email" placeholder="you@example.com">
              </div>
              <div class="actions">
                <button class="button" id="save-profile">Save</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">Preferences</div>
            <div class="form">
              <div class="field">
                <label class="label" for="theme">Theme</label>
                <select class="select" id="theme">
                  <option value="light">Light</option>
                  <option value="dark">Dark</option>
                </select>
              </div>
              <div class="actions">
                <button class="button secondary" id="apply-theme">Apply</button>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">Data Management</div>
            <div class="actions">
              <button class="button secondary" id="create-demo">Create demo data</button>
              <button class="button" id="clear-data">Clear all data</button>
            </div>
            <p class="muted">Clearing data removes tickets only. Settings are preserved.</p>
          </div>
          <div class="card">
            <div class="card-title">Backup & Restore</div>
            <div class="form">
              <div class="actions">
                <button class="button" id="export-json">Export tickets (.json)</button>
              </div>
              <div class="field">
                <label class="label" for="import-file">Import tickets (JSON)</label>
                <input class="input" id="import-file" type="file" accept=".json,application/json">
                <div id="import-error" class="muted" aria-live="polite"></div>
              </div>
              <div class="actions">
                <button class="button secondary" id="import-json">Import tickets</button>
                <a id="import-success-link" class="button" href="./tickets.html" style="display:none">Go to Tickets</a>
              </div>
              <p class="muted">Import restores tickets from a JSON backup. Existing tickets will be replaced after confirmation.</p>
            </div>
          </div>
        </div>
        <footer class="footer">PulseDesk © 2026 – Internal Support Platform.</footer>
      </main>
    </div>
  </div>
<script src="../js/app.js"></script>
<script src="../js/storage.js"></script>
<script src="../js/seed.js"></script>
<script src="../js/theme.js"></script>
<script src="../js/sidebar.js"></script>
<script>
  (function(){
    var S = window.PulseDeskStorage;
    if (!S) return;
    var $name = document.getElementById("agent-name");
    var $email = document.getElementById("agent-email");
    var $save = document.getElementById("save-profile");
    var $theme = document.getElementById("theme");
    var $apply = document.getElementById("apply-theme");
    var $create = document.getElementById("create-demo");
    var $clear = document.getElementById("clear-data");
    var $toast = document.getElementById("settings-toast");
    var $export = document.getElementById("export-json");
    var $importFile = document.getElementById("import-file");
    var $importBtn = document.getElementById("import-json");
    var $importErr = document.getElementById("import-error");
    var $importSuccessLink = document.getElementById("import-success-link");
    function toast(msg, type){ if (window.PulseDeskUI && window.PulseDeskUI.toast) window.PulseDeskUI.toast(msg, type); }
    function applyTheme(theme){
      document.documentElement.setAttribute("data-theme", theme==="dark" ? "dark" : "light");
    }
    function init(){
      var st = S.getSettings();
      $name.value = st.agentName || "";
      $email.value = st.agentEmail || "";
      $theme.value = st.theme || "light";
      applyTheme(st.theme);
    }
    function ymd(date){
      var d = date || new Date();
      var y = d.getFullYear();
      var m = String(d.getMonth()+1).padStart(2,"0");
      var day = String(d.getDate()).padStart(2,"0");
      return y+"-"+m+"-"+day;
    }
    $export.addEventListener("click", function(){
      var data = {
        version: 1,
        exportedAt: new Date().toISOString(),
        tickets: S.getTickets()
      };
      var blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      var a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "pulsedesk-tickets-"+ymd(new Date())+".json";
      document.body.appendChild(a);
      a.click();
      setTimeout(function(){ URL.revokeObjectURL(a.href); a.remove(); }, 0);
      toast("Exported");
    });
    function validateImportShape(obj){
      if (!obj || typeof obj!=="object") return false;
      if (!Array.isArray(obj.tickets)) return false;
      for (var i=0;i<obj.tickets.length;i++){
        var t = obj.tickets[i] || {};
        if (!t.id || !t.createdAt || !t.status || !t.priority || !(t.subject || t.title)) return false;
      }
      return true;
    }
    var pendingImport = null;
    $importBtn.addEventListener("click", function(){
      $importErr.textContent = "";
      $importSuccessLink.style.display = "none";
      var f = $importFile.files && $importFile.files[0];
      if (!f){ $importErr.textContent = "Please choose a JSON file."; return; }
      var name = String(f.name||"");
      if (name.slice(-5).toLowerCase() !== ".json"){ $importErr.textContent = "Only .json files are accepted."; return; }
      var reader = new FileReader();
      reader.onload = function(e){
        var text = String(e.target.result||"");
        var obj;
        try { obj = JSON.parse(text); } catch(err){ $importErr.textContent = "Invalid JSON format."; return; }
        if (!validateImportShape(obj)){ $importErr.textContent = "Invalid backup structure."; return; }
        pendingImport = obj.tickets;
        showConfirm();
      };
      reader.onerror = function(){ $importErr.textContent = "Failed to read file."; };
      reader.readAsText(f);
    });
    function showConfirm(){
      var overlay = document.getElementById("confirm-overlay");
      overlay.style.display = "flex";
    }
    function hideConfirm(){
      var overlay = document.getElementById("confirm-overlay");
      overlay.style.display = "none";
    }
    function doImport(){
      if (!pendingImport) return;
      S.saveTickets(pendingImport);
      pendingImport = null;
      hideConfirm();
      toast("Import successful");
      $importSuccessLink.style.display = "inline-flex";
    }
    document.getElementById("confirm-yes").addEventListener("click", doImport);
    document.getElementById("confirm-cancel").addEventListener("click", function(){ pendingImport=null; hideConfirm(); });
    $save.addEventListener("click", function(){
      $save.disabled = true;
      var prevText = $save.textContent; $save.textContent = "Saving...";
      var st = S.getSettings();
      st.agentName = ($name.value||"").trim() || "You";
      st.agentEmail = ($email.value||"").trim();
      S.saveSettings(st);
      toast("Profile saved");
      $save.textContent = prevText; $save.disabled = false;
    });
    $apply.addEventListener("click", function(){
      $apply.disabled = true; var prevText = $apply.textContent; $apply.textContent = "Applying...";
      var val = $theme.value || "light";
      S.setTheme(val);
      applyTheme(val);
      toast("Theme applied");
      $apply.textContent = prevText; $apply.disabled = false;
    });
    $create.addEventListener("click", function(){
      $create.disabled = true; var prev = $create.textContent; $create.textContent = "Creating...";
      var ok = S.createDemoData();
      toast(ok ? "Demo data created" : "Tickets already exist");
      $create.textContent = prev; $create.disabled = false;
    });
    $clear.addEventListener("click", function(){
      $clear.disabled = true; var prev = $clear.textContent; $clear.textContent = "Clearing...";
      S.clearTickets();
      toast("All tickets cleared");
      $clear.textContent = prev; $clear.disabled = false;
    });
    init();
  })();
</script>
<div id="confirm-overlay" class="modal-overlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="confirm-title" onclick="event.stopPropagation()">
    <div class="modal-header">
      <div id="confirm-title">Confirm Import</div>
      <button class="button secondary" id="confirm-cancel">Cancel</button>
    </div>
    <p>Importing will replace existing tickets with the ones from the backup. Continue?</p>
    <div style="height:8px"></div>
    <div class="actions">
      <button class="button" id="confirm-yes">Confirm import</button>
    </div>
  </div>
</div>
</body>
</html>
