<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PulseDesk Â· Tickets</title>
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/components.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <img src="../assets/logo.svg" alt="PulseDesk logo">
        <span class="name">PulseDesk</span>
      </div>
      <nav class="nav">
        <a href="./dashboard.html">Dashboard</a>
        <a class="active" href="./tickets.html">Tickets</a>
        <a href="./new-ticket.html">New Ticket</a>
        <a href="#">Settings</a>
        <a href="#">Logout</a>
      </nav>
    </aside>
    <div class="content">
      <header class="topbar">
        <div class="topbar-left">
          <a class="logo-inline" href="./dashboard.html">
            <img src="../assets/logo.svg" alt="PulseDesk logo">
            <span class="wordmark">PulseDesk</span>
          </a>
        </div>
        <div class="topbar-right">
          <div class="avatar">U</div>
        </div>
      </header>
      <main class="main">
        <h1 class="section-title">Tickets</h1>
        <div class="card">
          <div class="filters" id="filters">
            <input class="input" type="search" id="q" placeholder="Search subject, requester, email">
            <select class="select" id="f-status">
              <option value="">All statuses</option>
              <option value="open">Open</option>
              <option value="pending">Pending</option>
              <option value="resolved">Resolved</option>
              <option value="closed">Closed</option>
            </select>
            <select class="select" id="f-priority">
              <option value="">All priorities</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="urgent">Urgent</option>
            </select>
            <button class="button secondary" id="clear">Clear filters</button>
          </div>
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Subject</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Assignee</th>
                <th>Created</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="empty" style="display:none; padding:16px;">
            <p class="muted">No tickets found.</p>
            <div style="height:12px"></div>
            <a class="button" href="./new-ticket.html">Create new ticket</a>
          </div>
        </div>
      </main>
    </div>
  </div>
<script src="../js/storage.js"></script>
<script src="../js/seed.js"></script>
<script>
  (function () {
    var S = window.PulseDeskStorage;
    if (!S) return;
    var $tbody = document.querySelector("tbody");
    var $empty = document.getElementById("empty");
    var $q = document.getElementById("q");
    var $fStatus = document.getElementById("f-status");
    var $fPriority = document.getElementById("f-priority");
    var $clear = document.getElementById("clear");
    function shortId(id) {
      if (!id) return "";
      var s = String(id);
      return s.length > 6 ? s.slice(-6) : s;
    }
    function formatDate(s) {
      try {
        var d = new Date(s);
        return d.toLocaleString();
      } catch (e) {
        return s || "";
      }
    }
    function statusLabel(v) {
      var m = { open: "Open", in_progress: "Pending", resolved: "Resolved", closed: "Closed" };
      return m[v] || v || "";
    }
    function statusClass(v) {
      var m = { open: "open", in_progress: "pending", resolved: "resolved", closed: "closed" };
      return m[v] || "open";
    }
    function priorityLabel(v) {
      var m = { low: "Low", medium: "Medium", high: "High", urgent: "Urgent" };
      return m[v] || v || "";
    }
    function priorityClass(v) {
      var m = { low: "low", medium: "medium", high: "high", urgent: "urgent" };
      return m[v] || "low";
    }
    function normalizeStatusFilter(v) {
      if (v === "pending") return "in_progress";
      return v;
    }
    function getData() {
      return S.getTickets();
    }
    function filterData(list) {
      var q = ($q.value || "").toLowerCase();
      var fs = normalizeStatusFilter($fStatus.value || "");
      var fp = ($fPriority.value || "");
      return list.filter(function (t) {
        var okS = !fs || String(t.status) === fs;
        var okP = !fp || String(t.priority) === fp;
        var text = [t.title, t.customer, t.assignee, t.description].join(" ").toLowerCase();
        var okQ = !q || text.indexOf(q) !== -1;
        return okS && okP && okQ;
      });
    }
    function render() {
      var list = filterData(getData());
      if (list.length === 0) {
        $tbody.innerHTML = "";
        $empty.style.display = "block";
        return;
      }
      $empty.style.display = "none";
      var rows = list.map(function (t) {
        var idShort = shortId(t.id);
        var plabel = priorityLabel(t.priority);
        var pcls = priorityClass(t.priority);
        var slabel = statusLabel(t.status);
        var scls = statusClass(t.status);
        var created = formatDate(t.createdAt);
        var assignee = t.assignee ? String(t.assignee) : "Unassigned";
        var href = "./ticket.html?id=" + encodeURIComponent(String(t.id));
        return (
          "<tr>" +
          "<td>" + idShort + "</td>" +
          "<td>" + (t.title || "") + "</td>" +
          "<td><span class='badge badge-priority " + pcls + "'>" + plabel + "</span></td>" +
          "<td><span class='badge badge-status " + scls + "'>" + slabel + "</span></td>" +
          "<td>" + assignee + "</td>" +
          "<td>" + created + "</td>" +
          "<td><a class='button secondary' href='" + href + "'>View</a></td>" +
          "</tr>"
        );
      }).join("");
      $tbody.innerHTML = rows;
    }
    $q.addEventListener("input", render);
    $fStatus.addEventListener("change", render);
    $fPriority.addEventListener("change", render);
    $clear.addEventListener("click", function () {
      $q.value = "";
      $fStatus.value = "";
      $fPriority.value = "";
      render();
    });
    render();
  })();
</script>
</body>
</html>
